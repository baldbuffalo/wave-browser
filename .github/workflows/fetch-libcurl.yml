name: Auto Update libcurl (WiiU)

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  update-libcurl:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    steps:
      # 1️⃣ Checkout repository
      - name: Checkout repo
        uses: actions/checkout@v6.0.2

      # 2️⃣ Remove old folders
      - name: Clean old folders
        run: rm -rf curl curl-temp

      # 3️⃣ Clone latest upstream libcurl
      - name: Clone latest libcurl
        run: git clone --depth=1 https://github.com/wiiu-env/libcurlwrapper.git curl-temp

      # 4️⃣ Copy files into repo (no nested .git)
      - name: Copy libcurl files
        run: |
          mkdir curl
          cp -r curl-temp/* curl/
          rm -rf curl-temp

      # 5️⃣ Create Pull Request only if changes exist
      - name: Create Pull Request if needed
        uses: peter-evans/create-pull-request@v8.1.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "Update libcurl to latest upstream"
          title: "Update libcurl (auto)"
          body: |
            This PR updates libcurl to the latest commit from:
            https://github.com/wiiu-env/libcurlwrapper

            Automatically created only if upstream changes.
          branch: update-libcurl
          delete-branch: true
